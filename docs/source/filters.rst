Фильтры (filters)
=================

Для каждой группы/подгруппы может быть указан фильтр, который будет отбирать в эту группу объекты ЦИМ по заданным условиям.

.. important::

    Важен порядок применения фильтров. Правила, указанные в JSON, выполняются последовательно, начиная с верхней строки. Уже сгруппированные объекты ЦИМ исключаются из модели данных для последующих групп/подгрупп.

Фильтры могут быть заданы:

1. По значению

2. С помощью логических условий для объединения фильтров в логический оператор

По значению (by value)
----------------------

Задаются с помощью следующих атрибутов:

* ``valueName`` — имя атрибута, по которому будут отбираться объекты;
* ``instruction`` — :ref:`условный оператор <instructions>`, сравнивающий значение атрибута;
* ``value`` — значение атрибута.

.. code-block::
    :caption: Фильтр, отбирающий объекты, у которых ``ObjectType`` соответствует значению ``Window``.
    :linenos:

    "filter": {
        "valueName": "ObjectType",
        "instruction": "exact",
        "value": "Window"
    }

.. important::

    Поскольку BIM Classifier обращается к ЦИМ через API Renga, наименование некоторых атрибутов (и их значения) отличаются от локализованных в пользовательском интерфейсе. Для определения правильного наименования ``valueName`` нужного атрибута воспользуйтесь командой "Информация об объекте" на панели действий.

.. _instructions:

Условные операторы (instructions)
---------------------------------

Следующие условные операторы можно применять в фильтрах:

.. csv-table:: Операторы
    :header: "instruction", "Условие"

    "contains", "содержит"
    "partOf", "является частью (строки)"
    "exact", "совпадает"
    "greater", "больше"
    "less", "меньше"

Логические условия в фильтрах
-----------------------------

Более сложные фильтры можно создавать с помощью следующих логических условий:

* **All** — Возвращает ``true`` если **все** указанные условия верны. Принимает массив фильтров.

    .. code-block::
        :caption: Фильтр, отбирающий объекты, у которых соответствуют условиям обоих указанных фильтров.
        :linenos:

        "filter": {
            "all": [
                {   // Фильтр 1
                    "valueName": "ObjectType",
                    "instruction": "exact",
                    "value": "Equipment"
                },
                {   // Фильтр 2
                    "valueName": "parameter/Категория",
                    "instruction": "exact",
                    "value": "Спускной кран"
                }
            ]
        }

* **Not** — Возвращает ``true`` если указанное условие не верно. Принимает один фильтр.

    .. code-block::
        :caption: Фильтр, отбирающий объекты, которые не соответствуют указанному условию.
        :linenos:

        "filter": {
            "not": {
                "valueName": "ObjectType",
                "instruction": "exact",
                "value": "Rebar"
            }
        }

* **Any** — Возвращает ``true`` если какое-либо из указанных условий верно. Принимает массив фильтров.

    .. code-block::
        :caption: Фильтр, отбирающий объекты, которые соответствуют условиям любому из указанных фильтров.
        :linenos:

        "filter": {
            "any": [
                {   // Фильтр 1
                    "valueName": "Многослойный материал/Name",
                    "instruction": "contains",
                    "value": "Стена"
                },
                {   // Фильтр 2
                    "valueName": "Многослойный материал/Name",
                    "instruction": "contains",
                    "value": "Перегородка"
                }
            ]
        }

